---
import Base from "@/layouts/Base.astro";
import DocSingle from "@/layouts/DocSingle.astro";
import DocGroup from "@/layouts/DocGroup.astro";
import { getSinglePage, getDocumentsInGroup } from "@/lib/contentParser.astro";
import config from "@/config/config.json";

export async function getStaticPaths() {
  const docs = await getSinglePage(config.settings.docs_folder);
  const paths = [];

  docs.forEach((post) => {
    const segments = post.slug.split("/");
    if (segments.length === 1) {
      paths.push({
        params: { id: segments[0] },
        props: { post, isGroup: true },
      });
    } else {
      paths.push({
        params: { id: post.slug },
        props: { post, isGroup: false },
      });
    }
  });

  return paths;
}

const { post, isGroup } = Astro.props;

const documents = isGroup ? await getDocumentsInGroup(config.settings.docs_folder, post.slug) : [];
---

<Base
  title={post.data.title}
  image={post.data.image}
  description={post.data.description}
>
  {isGroup ? (
    <DocGroup documents={documents} />
  ) : (
    <DocSingle post={post} />
  )}
</Base>
